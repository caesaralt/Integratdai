<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integratd living - Automated Quoting Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #556B2F 0%, #3D4F1F 100%); color: white; padding: 40px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content { padding: 40px; }
        .upload-section { background: #f8f9fa; border-radius: 15px; padding: 40px; margin-bottom: 30px; border: 2px dashed #556B2F; cursor: pointer; transition: all 0.3s; text-align: center; }
        .upload-section:hover { background: #e9ecef; transform: translateY(-2px); }
        .upload-icon { font-size: 4em; margin-bottom: 20px; }
        input[type="file"] { display: none; }
        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 600; color: #556B2F; margin-bottom: 10px; font-size: 1.1em; }
        input[type="text"] { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1em; transition: border 0.3s; }
        input[type="text"]:focus { outline: none; border-color: #556B2F; }
        .tier-selection { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .tier-card { background: #f8f9fa; border: 2px solid #ddd; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .tier-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .tier-card.selected { background: #556B2F; color: white; border-color: #556B2F; }
        .automation-types { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .checkbox-card { background: #f8f9fa; border: 2px solid #ddd; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .checkbox-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .checkbox-card.selected { background: #556B2F; color: white; border-color: #556B2F; }
        .checkbox-card .symbol { font-size: 2.5em; margin-bottom: 10px; }
        .checkbox-card .name { font-weight: 600; }
        .analyze-btn { width: 100%; padding: 20px; background: linear-gradient(135deg, #556B2F 0%, #3D4F1F 100%); color: white; border: none; border-radius: 12px; font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(85, 107, 47, 0.3); }
        .analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: none; text-align: center; padding: 40px; }
        .loading.active { display: block; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #556B2F; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .results { display: none; margin-top: 30px; padding: 30px; background: #f8f9fa; border-radius: 15px; }
        .results.active { display: block; }
        .results h2 { color: #556B2F; margin-bottom: 20px; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .result-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .result-card h3 { color: #556B2F; margin-bottom: 10px; font-size: 1.1em; }
        .result-card p { font-size: 2em; font-weight: 600; color: #333; }
        .download-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 25px; }
        .download-btn { padding: 15px 25px; background: #556B2F; color: white; text-decoration: none; border-radius: 10px; text-align: center; font-weight: 600; transition: all 0.3s; display: block; }
        .download-btn:hover { background: #3D4F1F; transform: translateY(-2px); }
        .error { display: none; padding: 20px; background: #fee; border: 1px solid #fcc; border-radius: 10px; color: #c33; margin-top: 20px; }
        .error.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Integratd living</h1>
            <p>Automated Quoting Tool</p>
        </div>

        <div class="content">
            <div class="upload-section" onclick="document.getElementById('floorplan').click()">
                <div class="upload-icon">üìÑ</div>
                <h2>Upload Floor Plan PDF</h2>
                <p>Click to select or drag & drop your floor plan</p>
                <input type="file" id="floorplan" accept=".pdf" onchange="handleFileSelect(this)">
                <p id="filename" style="margin-top: 15px; font-weight: 600; color: #556B2F;"></p>
            </div>

            <div class="form-group">
                <label for="project_name">Project Name</label>
                <input type="text" id="project_name" placeholder="Enter project name..." value="Residential Project">
            </div>

            <div class="form-group">
                <label>Select Tier</label>
                <div class="tier-selection">
                    <div class="tier-card selected" data-tier="basic" onclick="selectTier(this, 'basic')">
                        <h3>Basic</h3>
                        <p>Essential automation</p>
                    </div>
                    <div class="tier-card" data-tier="premium" onclick="selectTier(this, 'premium')">
                        <h3>Premium</h3>
                        <p>Advanced features</p>
                    </div>
                    <div class="tier-card" data-tier="deluxe" onclick="selectTier(this, 'deluxe')">
                        <h3>Deluxe</h3>
                        <p>Luxury automation</p>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Select Automation Types</label>
                <div class="automation-types">
                    <div class="checkbox-card" data-type="lighting" onclick="toggleAutomation(this)">
                        <div class="symbol">üí°</div>
                        <div class="name">Lighting Control</div>
                    </div>
                    <div class="checkbox-card" data-type="shading" onclick="toggleAutomation(this)">
                        <div class="symbol">ü™ü</div>
                        <div class="name">Shading Control</div>
                    </div>
                    <div class="checkbox-card" data-type="security_access" onclick="toggleAutomation(this)">
                        <div class="symbol">üîê</div>
                        <div class="name">Security & Access</div>
                    </div>
                    <div class="checkbox-card" data-type="climate" onclick="toggleAutomation(this)">
                        <div class="symbol">üå°</div>
                        <div class="name">Climate Control</div>
                    </div>
                    <div class="checkbox-card" data-type="audio" onclick="toggleAutomation(this)">
                        <div class="symbol">üîä</div>
                        <div class="name">Audio System</div>
                    </div>
                </div>
            </div>

            <button class="analyze-btn" onclick="analyzeFloorplan()">
                üöÄ Analyze & Generate Quote
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3>Analyzing floor plan...</h3>
                <p>This may take a moment</p>
            </div>

            <div class="error" id="error"></div>

            <div class="results" id="results">
                <h2>‚úÖ Analysis Complete!</h2>
                <div class="result-grid">
                    <div class="result-card">
                        <h3>Rooms Detected</h3>
                        <p id="rooms">0</p>
                    </div>
                    <div class="result-card">
                        <h3>Doors Found</h3>
                        <p id="doors">0</p>
                    </div>
                    <div class="result-card">
                        <h3>Windows Found</h3>
                        <p id="windows">0</p>
                    </div>
                    <div class="result-card">
                        <h3>Total Cost</h3>
                        <p id="total">$0.00</p>
                    </div>
                </div>
                <div class="download-buttons">
                    <a href="#" class="download-btn" id="download-annotated">üìÑ Download Annotated Plan</a>
                    <a href="#" class="download-btn" id="download-quote">üí∞ Download Quote</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let selectedTier = 'basic';
        let selectedAutomation = new Set();

        function handleFileSelect(input) {
            selectedFile = input.files[0];
            document.getElementById('filename').textContent = selectedFile ? `Selected: ${selectedFile.name}` : '';
        }

        function selectTier(element, tier) {
            document.querySelectorAll('.tier-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            selectedTier = tier;
        }

        function toggleAutomation(element) {
            const type = element.dataset.type;
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedAutomation.delete(type);
            } else {
                element.classList.add('selected');
                selectedAutomation.add(type);
            }
        }

        async function analyzeFloorplan() {
            if (!selectedFile) {
                showError('Please upload a floor plan PDF first');
                return;
            }

            if (selectedAutomation.size === 0) {
                showError('Please select at least one automation type');
                return;
            }

            const formData = new FormData();
            formData.append('floorplan', selectedFile);
            formData.append('project_name', document.getElementById('project_name').value);
            formData.append('tier', selectedTier);
            selectedAutomation.forEach(type => formData.append('automation_types[]', type));

            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('error').classList.remove('active');
            document.querySelector('.analyze-btn').disabled = true;

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('rooms').textContent = data.analysis.rooms_detected;
                    document.getElementById('doors').textContent = data.analysis.doors_detected;
                    document.getElementById('windows').textContent = data.analysis.windows_detected;
                    document.getElementById('total').textContent = `$${data.costs.grand_total.toFixed(2)}`;
                    
                    document.getElementById('download-annotated').href = data.files.annotated_pdf;
                    document.getElementById('download-quote').href = data.files.quote_pdf;

                    document.getElementById('results').classList.add('active');
                } else {
                    showError(data.error || 'Analysis failed');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('active');
                document.querySelector('.analyze-btn').disabled = false;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
        }
    </script>
</body>
</html>
